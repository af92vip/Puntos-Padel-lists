<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puntos Padel-lists</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#5E2B97">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f0fa;
  padding: 15px;
}
h1 {
  color: #5E2B97;
}
button {
  background: #2ecc71;
  border: none;
  padding: 12px;
  color: white;
  font-size: 16px;
  width: 100%;
  border-radius: 8px;
  margin-top: 10px;
}
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
}
.card {
  background: white;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>ðŸŽ¾ Puntos Padel-lists</h1>

<select id="numPlayers">
  <option value="4">4 jugadores</option>
  <option value="8">8 jugadores</option>
  <option value="12">12 jugadores</option>
</select>

<select id="gamePoints">
  <option value="6">Juego a 6</option>
  <option value="8">Juego a 8</option>
</select>

<button onclick="crearJugadores()">Crear jugadores</button>

<div id="inputs"></div>

<button onclick="nuevaRonda()">ðŸŽ² Nueva ronda</button>

<div id="partidos"></div>

<h2>ðŸ“Š Tabla</h2>
<div id="tabla"></div>

<script>
let nombres = [];
let stats = [];
let parejasUsadas = new Set();
let rondaActual = [];

function crearJugadores() {
  parejasUsadas.clear();
  stats = [];
  let n = numPlayers.value;
  let html = "";
  for (let i = 0; i < n; i++) {
    html += `<input id="j${i}" placeholder="Jugador ${i+1}">`;
    stats.push({ puntos: 0, juegos: 0 });
  }
  inputs.innerHTML = html;
  partidos.innerHTML = "";
  tabla.innerHTML = "";
}

function nuevaRonda() {
  let n = numPlayers.value;
  nombres = [];

  for (let i = 0; i < n; i++) {
    let nombre = document.getElementById("j"+i).value;
    if (!nombre) {
      alert("Faltan nombres");
      return;
    }
    nombres.push(nombre);
  }

  let indices = [...Array(n).keys()];
  let usadosRonda = new Set();
  rondaActual = [];

  function parejaUsada(a,b) {
    return parejasUsadas.has([a,b].sort().join("-"));
  }

  while (indices.length >= 4) {
    let a = indices.shift();

    let bIndex = indices.findIndex(x => !parejaUsada(a,x));
    if (bIndex === -1) break;

    let b = indices.splice(bIndex,1)[0];
    let c = indices.shift();
    let d = indices.shift();

    rondaActual.push([a,b,c,d]);
    usadosRonda.add([a,b].sort().join("-"));
    usadosRonda.add([c,d].sort().join("-"));
  }

  if (rondaActual.length === 0) {
    alert("âœ… Ya se jugaron todas las combinaciones posibles");
    return;
  }

  mostrarPartidos(rondaActual);
}

function mostrarPartidos(juegos) {
  let max = gamePoints.value;
  let opciones = max == 6
    ? ["6-0","5-1","4-2","3-3"]
    : ["8-0","7-1","6-2","5-3","4-4"];

  partidos.innerHTML = juegos.map(j => `
    <div class="card">
      ${nombres[j[0]]} + ${nombres[j[1]]}
      vs
      ${nombres[j[2]]} + ${nombres[j[3]]}
      <select onchange="guardarResultado('${j}',this.value)">
        <option value="">Resultado</option>
        ${opciones.map(o=>`<option>${o}</option>`).join("")}
      </select>
    </div>
  `).join("");
}

function guardarResultado(j,res) {
  if (!res) return;

  let [a,b] = res.split("-").map(Number);
  let p = j.split(",").map(Number);

  stats[p[0]].puntos += a;
  stats[p[1]].puntos += a;
  stats[p[2]].puntos += b;
  stats[p[3]].puntos += b;

  p.forEach(i => stats[i].juegos++);

  // Guardar parejas SOLO despuÃ©s del partido
  parejasUsadas.add([p[0],p[1]].sort().join("-"));
  parejasUsadas.add([p[2],p[3]].sort().join("-"));

  actualizarTabla();
}

function actualizarTabla() {
  tabla.innerHTML = nombres
    .map((n,i)=>`${n} â€” ${stats[i].puntos} pts`)
    .join("<br>");
}
</script>

</body>
</html>
